import React, {useCallback} from "react";
import {NavLink, useNavigate} from "react-router-dom";
import {FaCirclePlay} from "react-icons/fa6";
import {HiRectangleStack} from "react-icons/hi2";
import {AiFillQuestionCircle} from "react-icons/ai";
import {Button} from "./utils/button.component.tsx";
import {UserAvatar} from "./utils/user-avatar.component.tsx";
import {AppSettings} from "./settings/app-settings.component.tsx";
import {useSettingsQuery} from "../store/settings/hooks/useSettingsHook.tsx";
import {useAuthLogout, useAuthQuery} from "../store/auth/hooks/useAuthHook.ts";

export const AppMenu: React.FC = () => {
	const navigate = useNavigate();

	const {isLoading: userLoading, data: userData} = useAuthQuery();
	const {isLoading: settingsLoading} = useSettingsQuery();
	const {mutate: logout} = useAuthLogout();

	const handleLogout = useCallback(() => {
		void logout();
	}, []);

	const handleLogin = useCallback(() => {
		navigate('/login');
	}, []);

	if (userLoading || settingsLoading) {
		return null;
	}

	const loggedIn = !!userData?.id;

	return <nav id='app-menu'>
		<div className={'app-menu-content'}>
			<ul>
				<li className={'menu-logo home'}>
					<NavLink to="/home">
						<span>Kardissimo</span>
						<i></i>
						<svg viewBox="0 0 1024 1024">
							<path
								d="M 803.458984 840.673828 C 814.201233 846.044922 822.34729 852.400696 827.897461 859.741211 C 833.447632 867.081726 836.222656 876.302002 836.222656 887.402344 C 836.222656 903.515686 831.299194 917.838501 821.452148 930.371094 C 811.605103 942.903687 797.729919 949.169922 779.826172 949.169922 C 752.254395 949.169922 721.549988 933.862427 687.711914 903.24707 C 653.87384 872.631714 624.064575 834.318237 598.283203 788.305664 C 572.501831 742.293091 557.283875 698.161011 552.628906 655.908203 C 526.131348 689.567261 504.020599 720.540222 486.295898 748.828125 C 468.571198 777.116028 456.128296 801.106689 448.966797 820.800781 L 446.818359 859.472656 C 446.102203 874.51178 445.207031 887.044189 444.132813 897.070313 C 442.7005 911.393311 436.344788 922.762024 425.06543 931.176758 C 413.786072 939.591492 399.552826 943.798828 382.365234 943.798828 C 367.326111 943.798828 354.346069 938.785889 343.424805 928.759766 C 332.50354 918.733643 327.042969 907.096436 327.042969 893.847656 C 327.042969 882.389282 331.518829 857.861511 340.470703 820.263672 C 347.632202 789.111206 353.003235 762.972107 356.583984 741.845703 C 362.671265 704.605957 370.727814 644.629333 380.753906 561.914063 L 384.513672 532.373047 C 402.775482 386.636658 414.681274 282.169922 420.231445 218.969727 C 425.781616 155.769531 429.09375 107.877747 430.167969 75.292969 C 430.884125 62.402283 431.421234 54.52478 431.779297 51.660156 C 433.569672 37.695251 439.925415 26.595093 450.84668 18.359375 C 461.767944 10.123657 476.001221 6.005859 493.546875 6.005859 C 510.018311 6.005859 523.445923 11.01886 533.830078 21.044922 C 544.214233 31.070984 549.40625 43.066345 549.40625 57.03125 C 549.40625 65.625061 548.511047 74.129211 546.720703 82.543945 C 544.930359 90.958679 542.244812 101.253174 538.664063 113.427734 C 533.292969 133.838013 529.533203 149.772095 527.384766 161.230469 C 515.210205 236.784241 500.171326 348.680908 482.267578 496.923828 C 474.389923 561.735352 468.481781 612.93927 464.542969 650.537109 C 536.157898 532.372437 600.69989 441.959961 658.170898 379.296875 C 715.641907 316.633789 761.743286 285.302734 796.476563 285.302734 C 814.022217 285.302734 827.986938 290.405212 838.371094 300.610352 C 848.755249 310.815491 853.947266 323.795471 853.947266 339.550781 C 853.947266 352.083374 848.397217 363.631104 837.296875 374.194336 C 826.196533 384.757568 808.472107 398.095642 784.123047 414.208984 C 781.616516 415.999329 774.723694 420.654236 763.444336 428.173828 C 752.164978 435.69342 741.691467 443.391907 732.023438 451.269531 C 708.03241 470.605591 687.174866 490.120361 669.450195 509.814453 C 651.725525 529.508545 635.164795 551.708862 619.767578 576.416016 C 620.483704 617.952637 630.778198 656.445129 650.651367 691.894531 C 670.524536 727.343933 694.336121 757.60083 722.086914 782.666016 C 749.837708 807.731262 776.961426 827.067017 803.458984 840.673828 Z"/>
						</svg>
						<svg viewBox="0 0 1024 1024" className={'shadowk'}>
							<path
								d="M 803.458984 840.673828 C 814.201233 846.044922 822.34729 852.400696 827.897461 859.741211 C 833.447632 867.081726 836.222656 876.302002 836.222656 887.402344 C 836.222656 903.515686 831.299194 917.838501 821.452148 930.371094 C 811.605103 942.903687 797.729919 949.169922 779.826172 949.169922 C 752.254395 949.169922 721.549988 933.862427 687.711914 903.24707 C 653.87384 872.631714 624.064575 834.318237 598.283203 788.305664 C 572.501831 742.293091 557.283875 698.161011 552.628906 655.908203 C 526.131348 689.567261 504.020599 720.540222 486.295898 748.828125 C 468.571198 777.116028 456.128296 801.106689 448.966797 820.800781 L 446.818359 859.472656 C 446.102203 874.51178 445.207031 887.044189 444.132813 897.070313 C 442.7005 911.393311 436.344788 922.762024 425.06543 931.176758 C 413.786072 939.591492 399.552826 943.798828 382.365234 943.798828 C 367.326111 943.798828 354.346069 938.785889 343.424805 928.759766 C 332.50354 918.733643 327.042969 907.096436 327.042969 893.847656 C 327.042969 882.389282 331.518829 857.861511 340.470703 820.263672 C 347.632202 789.111206 353.003235 762.972107 356.583984 741.845703 C 362.671265 704.605957 370.727814 644.629333 380.753906 561.914063 L 384.513672 532.373047 C 402.775482 386.636658 414.681274 282.169922 420.231445 218.969727 C 425.781616 155.769531 429.09375 107.877747 430.167969 75.292969 C 430.884125 62.402283 431.421234 54.52478 431.779297 51.660156 C 433.569672 37.695251 439.925415 26.595093 450.84668 18.359375 C 461.767944 10.123657 476.001221 6.005859 493.546875 6.005859 C 510.018311 6.005859 523.445923 11.01886 533.830078 21.044922 C 544.214233 31.070984 549.40625 43.066345 549.40625 57.03125 C 549.40625 65.625061 548.511047 74.129211 546.720703 82.543945 C 544.930359 90.958679 542.244812 101.253174 538.664063 113.427734 C 533.292969 133.838013 529.533203 149.772095 527.384766 161.230469 C 515.210205 236.784241 500.171326 348.680908 482.267578 496.923828 C 474.389923 561.735352 468.481781 612.93927 464.542969 650.537109 C 536.157898 532.372437 600.69989 441.959961 658.170898 379.296875 C 715.641907 316.633789 761.743286 285.302734 796.476563 285.302734 C 814.022217 285.302734 827.986938 290.405212 838.371094 300.610352 C 848.755249 310.815491 853.947266 323.795471 853.947266 339.550781 C 853.947266 352.083374 848.397217 363.631104 837.296875 374.194336 C 826.196533 384.757568 808.472107 398.095642 784.123047 414.208984 C 781.616516 415.999329 774.723694 420.654236 763.444336 428.173828 C 752.164978 435.69342 741.691467 443.391907 732.023438 451.269531 C 708.03241 470.605591 687.174866 490.120361 669.450195 509.814453 C 651.725525 529.508545 635.164795 551.708862 619.767578 576.416016 C 620.483704 617.952637 630.778198 656.445129 650.651367 691.894531 C 670.524536 727.343933 694.336121 757.60083 722.086914 782.666016 C 749.837708 807.731262 776.961426 827.067017 803.458984 840.673828 Z"/>
						</svg>
					</NavLink>
				</li>

				<li className={'faq'}>
					<NavLink to="/faq">
						<AiFillQuestionCircle/>
						<span>FAQ</span>
					</NavLink>
				</li>

				{loggedIn && <>
					<li>
						<NavLink to="/run">
							<FaCirclePlay/>
							<span>Run</span>
						</NavLink>
					</li>
					<li>
						<NavLink to="/cardboxes">
							<HiRectangleStack/>
							<span>Card boxes</span>
						</NavLink>
					</li>

					<li className={'icon-only'}>
						<AppSettings/>
					</li>
				</>}

				{!loggedIn && <li className={'login'}>
					<Button type={'danger'} onClick={handleLogin}>Login</Button>
				</li>}
			</ul>

			{loggedIn && <div className={'user-avatar'} tabIndex={0}>
				<UserAvatar src={userData.avatar} name={userData.name}/>

				<div className={'actions'}>
					<p>
						Logged in as <b>{userData.name}</b>
					</p>
					<Button type={'danger'} onClick={handleLogout}>Log out</Button>
				</div>
			</div>}
		</div>
	</nav>;
};
